version: "3.9"

services:
  neo4j:
    build:
      dockerfile: Dockerfile-neo4j
      context: .
    env_file:
      - .env.neo4j
    environment:
      - NEO4J_AUTH=${NEO4J_USER_AND_PASS}
    ports:
      - 7474:7474
      - 7687:7687
    volumes:
      - .:/ethecycle
      - ${NEO4J_DATA_DIR}/data:/data
      - ${NEO4J_DATA_DIR}/logs:/logs
      - ${TXION_DATA_DIR}:${TXION_DATA_MOUNT_DIR}
  python_etl:
    build:
      context: .
    tty: true
    stdin_open: true
    environment:
      - ETHECYCLE_ENV=${ETHECYCLE_ENV:-development}
      - NEO4J_AUTH=${NEO4J_USER_AND_PASS}
    env_file:
      - .env
    depends_on:
      - neo4j
    volumes:
      - .:/ethecycle
      - ${TXION_DATA_DIR}:${TXION_DATA_MOUNT_DIR}
    working_dir: /ethecycle
